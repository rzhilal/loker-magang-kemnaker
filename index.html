<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencari Lowongan Magang Hub Kemnaker Batch 3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .filter-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .multi-select-container {
            position: relative;
        }

        .multi-select-header {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .multi-select-header:hover {
            border-color: #667eea;
        }

        .multi-select-header.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .multi-select-placeholder {
            color: #666;
            font-size: 14px;
        }

        .multi-select-count {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .multi-select-arrow {
            transition: transform 0.3s;
        }

        .multi-select-arrow.active {
            transform: rotate(180deg);
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 5px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: none;
        }

        .multi-select-dropdown.active {
            display: block;
        }

        .multi-select-search {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }

        .multi-select-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
            outline: none;
        }

        .multi-select-search input:focus {
            border-color: #667eea;
        }

        .multi-select-options {
            padding: 5px;
        }

        .multi-select-option {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .multi-select-option:hover {
            background: #f5f5f5;
        }

        .multi-select-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .multi-select-option label {
            cursor: pointer;
            flex: 1;
            font-size: 14px;
            color: #333;
        }

        .multi-select-actions {
            padding: 10px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
            position: sticky;
            bottom: 0;
            background: white;
        }

        .multi-select-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .multi-select-btn-clear {
            background: #f5f5f5;
            color: #666;
        }

        .multi-select-btn-clear:hover {
            background: #e0e0e0;
        }

        .multi-select-btn-apply {
            background: #667eea;
            color: white;
        }

        .multi-select-btn-apply:hover {
            background: #5568d3;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 18px;
            padding: 20px;
        }

        .job-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .job-header {
            display: flex;
            align-items: start;
            gap: 20px;
            margin-bottom: 20px;
        }

        .company-logo {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .job-title {
            flex: 1;
        }

        .job-title h2 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .company-name {
            color: #667eea;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .location {
            color: #666;
            font-size: 0.95em;
        }

        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .badge-status {
            background: #d4edda;
            color: #155724;
        }

        .badge-quota {
            background: #fff3cd;
            color: #856404;
        }

        .badge-registered {
            background: #d1ecf1;
            color: #0c5460;
        }

        .job-description {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .job-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #333;
            min-width: 150px;
        }

        .detail-value {
            color: #666;
            flex: 1;
        }

        .programs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .program-tag {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
        }

        .no-results {
            text-align: center;
            color: white;
            font-size: 18px;
            padding: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .reset-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .job-header {
                flex-direction: column;
            }
            
            .detail-row {
                flex-direction: column;
            }
            
            .detail-label {
                margin-bottom: 5px;
            }

            .filter-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Pencari Lowongan Magang</h1>
            <p>Temukan kesempatan magang terbaik di Magang Hub Kemnaker</p>
        </div>

        <div class="filter-container">
            <input type="text" 
                   id="searchInput" 
                   class="search-input" 
                   placeholder="üîç Cari posisi, perusahaan, atau deskripsi...">
            
            <div class="filter-grid">
                <div class="filter-group">
                    <label>üåç Provinsi</label>
                    <div class="multi-select-container" id="provinsiContainer">
                        <div class="multi-select-header" onclick="toggleDropdown('provinsi')">
                            <span class="multi-select-placeholder" id="provinsiPlaceholder">Pilih Provinsi</span>
                            <span class="multi-select-arrow">‚ñº</span>
                        </div>
                        <div class="multi-select-dropdown" id="provinsiDropdown">
                            <div class="multi-select-search">
                                <input type="text" placeholder="Cari provinsi..." oninput="filterOptions('provinsi', this.value)">
                            </div>
                            <div class="multi-select-options" id="provinsiOptions"></div>
                            <div class="multi-select-actions">
                                <button class="multi-select-btn multi-select-btn-clear" onclick="clearSelection('provinsi')">Hapus</button>
                                <button class="multi-select-btn multi-select-btn-apply" onclick="applyFilters()">Terapkan</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>üèôÔ∏è Kabupaten/Kota</label>
                    <div class="multi-select-container" id="kabupatenContainer">
                        <div class="multi-select-header" onclick="toggleDropdown('kabupaten')">
                            <span class="multi-select-placeholder" id="kabupatenPlaceholder">Pilih Kabupaten/Kota</span>
                            <span class="multi-select-arrow">‚ñº</span>
                        </div>
                        <div class="multi-select-dropdown" id="kabupatenDropdown">
                            <div class="multi-select-search">
                                <input type="text" placeholder="Cari kabupaten/kota..." oninput="filterOptions('kabupaten', this.value)">
                            </div>
                            <div class="multi-select-options" id="kabupatenOptions"></div>
                            <div class="multi-select-actions">
                                <button class="multi-select-btn multi-select-btn-clear" onclick="clearSelection('kabupaten')">Hapus</button>
                                <button class="multi-select-btn multi-select-btn-apply" onclick="applyFilters()">Terapkan</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>üéì Jenjang Pendidikan</label>
                    <div class="multi-select-container" id="jenjangContainer">
                        <div class="multi-select-header" onclick="toggleDropdown('jenjang')">
                            <span class="multi-select-placeholder" id="jenjangPlaceholder">Pilih Jenjang</span>
                            <span class="multi-select-arrow">‚ñº</span>
                        </div>
                        <div class="multi-select-dropdown" id="jenjangDropdown">
                            <div class="multi-select-search">
                                <input type="text" placeholder="Cari jenjang..." oninput="filterOptions('jenjang', this.value)">
                            </div>
                            <div class="multi-select-options" id="jenjangOptions"></div>
                            <div class="multi-select-actions">
                                <button class="multi-select-btn multi-select-btn-clear" onclick="clearSelection('jenjang')">Hapus</button>
                                <button class="multi-select-btn multi-select-btn-apply" onclick="applyFilters()">Terapkan</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>üìö Program Studi</label>
                    <div class="multi-select-container" id="prodiContainer">
                        <div class="multi-select-header" onclick="toggleDropdown('prodi')">
                            <span class="multi-select-placeholder" id="prodiPlaceholder">Pilih Program Studi</span>
                            <span class="multi-select-arrow">‚ñº</span>
                        </div>
                        <div class="multi-select-dropdown" id="prodiDropdown">
                            <div class="multi-select-search">
                                <input type="text" placeholder="Cari program studi..." oninput="filterOptions('prodi', this.value)">
                            </div>
                            <div class="multi-select-options" id="prodiOptions"></div>
                            <div class="multi-select-actions">
                                <button class="multi-select-btn multi-select-btn-clear" onclick="clearSelection('prodi')">Hapus</button>
                                <button class="multi-select-btn multi-select-btn-apply" onclick="applyFilters()">Terapkan</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>üè¢ Perusahaan</label>
                    <div class="multi-select-container" id="perusahaanContainer">
                        <div class="multi-select-header" onclick="toggleDropdown('perusahaan')">
                            <span class="multi-select-placeholder" id="perusahaanPlaceholder">Pilih Perusahaan</span>
                            <span class="multi-select-arrow">‚ñº</span>
                        </div>
                        <div class="multi-select-dropdown" id="perusahaanDropdown">
                            <div class="multi-select-search">
                                <input type="text" placeholder="Cari perusahaan..." oninput="filterOptions('perusahaan', this.value)">
                            </div>
                            <div class="multi-select-options" id="perusahaanOptions"></div>
                            <div class="multi-select-actions">
                                <button class="multi-select-btn multi-select-btn-clear" onclick="clearSelection('perusahaan')">Hapus</button>
                                <button class="multi-select-btn multi-select-btn-apply" onclick="applyFilters()">Terapkan</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button id="resetBtn" class="reset-btn">üîÑ Reset Filter</button>
            </div>
        </div>

        <div id="stats" class="stats" style="display: none;"></div>
        <div id="loading" class="loading">‚è≥ Memuat semua data lowongan...</div>
        <div id="jobList"></div>
        <div id="pagination" style="text-align:center; margin-top:30px; color:white;"></div>
    </div>

    <script>
        let currentPage = 1;
        const itemsPerPage = 250;

        let allJobs = [];
        let filteredJobs = [];
        const selectedFilters = {
            provinsi: new Set(),
            kabupaten: new Set(),
            jenjang: new Set(),
            prodi: new Set(),
            perusahaan: new Set()
        };
        const allOptions = {
            provinsi: [],
            kabupaten: [],
            jenjang: [],
            prodi: [],
            perusahaan: []
        };

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.multi-select-container')) {
                document.querySelectorAll('.multi-select-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('active');
                });
                document.querySelectorAll('.multi-select-header').forEach(header => {
                    header.classList.remove('active');
                });
                document.querySelectorAll('.multi-select-arrow').forEach(arrow => {
                    arrow.classList.remove('active');
                });
            }
        });

        function toggleDropdown(type) {
            event.stopPropagation();
            const dropdown = document.getElementById(`${type}Dropdown`);
            const header = event.currentTarget;
            const arrow = header.querySelector('.multi-select-arrow');
            const isActive = dropdown.classList.contains('active');
            
            // Close all dropdowns
            document.querySelectorAll('.multi-select-dropdown').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.multi-select-header').forEach(h => h.classList.remove('active'));
            document.querySelectorAll('.multi-select-arrow').forEach(a => a.classList.remove('active'));
            
            // Toggle current dropdown
            if (!isActive) {
                dropdown.classList.add('active');
                header.classList.add('active');
                arrow.classList.add('active');
            }
        }

        function filterOptions(type, searchText) {
            const options = allOptions[type];
            const container = document.getElementById(`${type}Options`);
            const filtered = options.filter(opt => 
                opt.toLowerCase().includes(searchText.toLowerCase())
            );
            
            container.innerHTML = filtered.map(option => {
                const checked = selectedFilters[type].has(option) ? 'checked' : '';
                const safeId = `${type}_${option.replace(/[^a-zA-Z0-9]/g, '_')}`;
                const escapedOption = option.replace(/'/g, "\\'");
                return `
                    <div class="multi-select-option">
                        <input type="checkbox" 
                               id="${safeId}" 
                               value="${option}"
                               ${checked}
                               onchange="toggleOption('${type}', '${escapedOption}')">
                        <label for="${safeId}">${option}</label>
                    </div>
                `;
            }).join('');
        }

        function toggleOption(type, option) {
            if (selectedFilters[type].has(option)) {
                selectedFilters[type].delete(option);
            } else {
                selectedFilters[type].add(option);
            }
            updatePlaceholder(type);
        }

        function updatePlaceholder(type) {
            const placeholder = document.getElementById(`${type}Placeholder`);
            const count = selectedFilters[type].size;
            const labels = {
                provinsi: 'Provinsi',
                kabupaten: 'Kabupaten/Kota',
                jenjang: 'Jenjang',
                prodi: 'Program Studi',
                perusahaan: 'Perusahaan'
            };
            
            if (count === 0) {
                placeholder.innerHTML = `Pilih ${labels[type]}`;
            } else {
                placeholder.innerHTML = `
                    ${labels[type]}: 
                    <span class="multi-select-count">${count} dipilih</span>
                `;
            }
        }

        function clearSelection(type) {
            selectedFilters[type].clear();
            updatePlaceholder(type);
            filterOptions(type, '');
            applyFilters();
        }

        async function fetchAllJobs() {
            try {
                document.getElementById('loading').innerHTML = 
                    '‚è≥ Memuat data lowongan dari file lokal...';

                // Ambil data dari file lokal data.json
                const response = await fetch('./data_batch_3.json');
                const data = await response.json();

                // Asumsikan struktur data sama dengan data dari API (data.data berisi array lowongan)
                if (data.data && data.data.length > 0) {
                    allJobs = data.data;
                } else if (Array.isArray(data)) {
                    // Jika file JSON langsung berupa array
                    allJobs = data;
                } else {
                    throw new Error('Format data.json tidak sesuai.');
                }

                filteredJobs = [...allJobs];

                // Jalankan fungsi-fungsi lanjutan
                populateFilters();
                displayStats(filteredJobs);
                displayJobs(filteredJobs);

                document.getElementById('loading').style.display = 'none';

                console.log(`‚úÖ Berhasil memuat ${allJobs.length} lowongan dari data.json`);
            } catch (error) {
                document.getElementById('loading').innerHTML =
                    '<div class="no-results">‚ùå Gagal memuat data dari data.json.</div>';
                console.error('Error fetching jobs:', error);
            }
        }


        function populateFilters() {
            const provinsiSet = new Set();
            const kabupatenSet = new Set();
            const jenjangSet = new Set();
            const prodiSet = new Set();
            const perusahaanSet = new Set();

            allJobs.forEach(job => {
                if (job.perusahaan?.nama_provinsi) {
                    provinsiSet.add(job.perusahaan.nama_provinsi);
                }
                if (job.perusahaan?.nama_kabupaten) {
                    kabupatenSet.add(job.perusahaan.nama_kabupaten);
                }
                if (job.perusahaan?.nama_perusahaan) {
                    perusahaanSet.add(job.perusahaan.nama_perusahaan);
                }
                
                try {
                    const jenjangArray = JSON.parse(job.jenjang || '[]');
                    jenjangArray.forEach(j => jenjangSet.add(j));
                } catch (e) {}
                
                try {
                    const prodiArray = JSON.parse(job.program_studi || '[]');
                    prodiArray.forEach(p => {
                        if (p.title) prodiSet.add(p.title);
                    });
                } catch (e) {}
            });

            allOptions.provinsi = Array.from(provinsiSet).sort();
            allOptions.kabupaten = Array.from(kabupatenSet).sort();
            allOptions.jenjang = Array.from(jenjangSet).sort();
            allOptions.prodi = Array.from(prodiSet).sort();
            allOptions.perusahaan = Array.from(perusahaanSet).sort();

            filterOptions('provinsi', '');
            filterOptions('kabupaten', '');
            filterOptions('jenjang', '');
            filterOptions('prodi', '');
            filterOptions('perusahaan', '');
        }

        function applyFilters() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            filteredJobs = allJobs.filter(job => {
                const perusahaanData = job.perusahaan || {};
                
                const matchSearch = !searchText || 
                    job.posisi.toLowerCase().includes(searchText) ||
                    perusahaanData.nama_perusahaan?.toLowerCase().includes(searchText) ||
                    job.deskripsi_posisi?.toLowerCase().includes(searchText);
                
                const matchProvinsi = selectedFilters.provinsi.size === 0 || 
                    selectedFilters.provinsi.has(perusahaanData.nama_provinsi);
                
                const matchKabupaten = selectedFilters.kabupaten.size === 0 || 
                    selectedFilters.kabupaten.has(perusahaanData.nama_kabupaten);
                
                const matchPerusahaan = selectedFilters.perusahaan.size === 0 || 
                    selectedFilters.perusahaan.has(perusahaanData.nama_perusahaan);
                
                let matchJenjang = selectedFilters.jenjang.size === 0;
                if (!matchJenjang) {
                    try {
                        const jenjangArray = JSON.parse(job.jenjang || '[]');
                        matchJenjang = jenjangArray.some(j => selectedFilters.jenjang.has(j));
                    } catch (e) {
                        matchJenjang = false;
                    }
                }
                
                let matchProdi = selectedFilters.prodi.size === 0;
                if (!matchProdi) {
                    try {
                        const prodiArray = JSON.parse(job.program_studi || '[]');
                        matchProdi = prodiArray.some(p => selectedFilters.prodi.has(p.title));
                    } catch (e) {
                        matchProdi = false;
                    }
                }

                return matchSearch && matchProvinsi && matchKabupaten && matchJenjang && matchProdi && matchPerusahaan;
            });

            displayStats(filteredJobs);
            displayJobs(filteredJobs);
        }

        function displayStats(jobs) {
            const totalQuota = jobs.reduce((sum, job) => sum + (job.jumlah_kuota || 0), 0);
            const totalRegistered = jobs.reduce((sum, job) => sum + (job.jumlah_terdaftar || 0), 0);
            const availableSlots = totalQuota - totalRegistered;

            document.getElementById('stats').style.display = 'grid';
            document.getElementById('stats').innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${jobs.length}</div>
                    <div class="stat-label">Lowongan Tersedia</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${totalQuota}</div>
                    <div class="stat-label">Total Kuota</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${totalRegistered}</div>
                    <div class="stat-label">Total Pendaftar</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${availableSlots}</div>
                    <div class="stat-label">Sisa Kuota</div>
                </div>
            `;
        }

        function displayJobs(jobs) {
            const jobList = document.getElementById('jobList');
            const totalPages = Math.ceil(jobs.length / itemsPerPage);

            // Jika tidak ada data
            if (jobs.length === 0) {
                jobList.innerHTML = '<div class="no-results">üîç Tidak ada lowongan ditemukan dengan filter yang dipilih</div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            // Hitung index awal dan akhir data yang akan ditampilkan
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const jobsToDisplay = jobs.slice(start, end);

            // Tampilkan data per halaman
            jobList.innerHTML = jobsToDisplay.map(job => {
                const programStudi = JSON.parse(job.program_studi || '[]');
                const jenjang = JSON.parse(job.jenjang || '[]');
                const perusahaan = job.perusahaan || {};
                const jadwal = job.jadwal || {};
                const sisaKuota = (job.jumlah_kuota || 0) - (job.jumlah_terdaftar || 0);

                return `
                    <div class="job-card">
                        <div class="job-header">
                            <img src="${perusahaan.logo || 'https://via.placeholder.com/80'}" 
                                alt="${perusahaan.nama_perusahaan}" 
                                class="company-logo"
                                onerror="this.src='https://via.placeholder.com/80?text=No+Logo'">
                            <div class="job-title">
                                <h2>${job.posisi}</h2>
                                <div class="company-name">${perusahaan.nama_perusahaan}</div>
                                <div class="location">üìç ${perusahaan.nama_kabupaten}, ${perusahaan.nama_provinsi}</div>
                            </div>
                        </div>

                        <div class="badge-container">
                            <span class="badge badge-status">‚úÖ ${job.ref_status_posisi?.nama_status_posisi || 'Status tidak tersedia'}</span>
                            <span class="badge badge-quota">üë• Kuota: ${job.jumlah_kuota}</span>
                            <span class="badge badge-registered">üìù Pendaftar: ${job.jumlah_terdaftar}</span>
                            <span class="badge ${sisaKuota > 0 ? 'badge-status' : 'badge-quota'}">
                                ${sisaKuota > 0 ? 'üéØ Sisa: ' + sisaKuota : '‚ö†Ô∏è Penuh'}
                            </span>
                        </div>

                        <div class="job-description">
                            <strong>Deskripsi:</strong><br>
                            ${job.deskripsi_posisi || 'Tidak ada deskripsi'}
                        </div>
                    </div>
                `;
            }).join('');

            // Tambahkan kontrol pagination
            renderPagination(totalPages);
        }

        function renderPagination(totalPages) {
            let paginationHTML = '';

            if (totalPages > 1) {
                paginationHTML += `
                    <div class="pagination">
                        <button ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">‚¨ÖÔ∏è Sebelumnya</button>
                        <span>Halaman ${currentPage} dari ${totalPages}</span>
                        <button ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">Berikutnya ‚û°Ô∏è</button>
                    </div>
                `;
            }

            document.getElementById('pagination').innerHTML = paginationHTML;
        }

        function changePage(page) {
            currentPage = page;
            displayJobs(filteredJobs);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        


        document.getElementById('searchInput').addEventListener('input', applyFilters);

        document.getElementById('resetBtn').addEventListener('click', () => {
            document.getElementById('searchInput').value = '';
            
            Object.keys(selectedFilters).forEach(key => {
                selectedFilters[key].clear();
                updatePlaceholder(key);
                filterOptions(key, '');
            });
            
            applyFilters();
        });

        fetchAllJobs();
    </script>
</body>
</html>
